{"version":3,"file":"tls.cjs","sources":["../../../../src/mods/tls/tls.ts"],"sourcesContent":["import { Future } from \"libs/future.js\"\nimport type { tls } from \"node-forge\"\n\nexport abstract class Tls extends EventTarget {\n  readonly abstract connection: tls.Connection\n\n  protected _closed = false\n\n  get closed() {\n    return this._closed\n  }\n\n  send(array: Buffer) {\n    const binary = array.toString(\"binary\")\n    this.connection.prepare(binary)\n  }\n\n  private async waitOpen() {\n    const future = new Future<Event, Event>()\n\n    try {\n      this.addEventListener(\"close\", future.err, { passive: true })\n      this.addEventListener(\"error\", future.err, { passive: true })\n      this.addEventListener(\"open\", future.ok, { passive: true })\n      await future.promise\n    } finally {\n      this.removeEventListener(\"error\", future.err)\n      this.removeEventListener(\"close\", future.err)\n      this.removeEventListener(\"open\", future.ok)\n    }\n  }\n\n  async open() {\n    const wait = this.waitOpen()\n    this.connection.handshake()\n    await wait\n  }\n}"],"names":["future","Future"],"mappings":";;;;;AAGM,MAAgB,GAAI,SAAQ,WAAW,CAAA;AAA7C,IAAA,WAAA,GAAA;;QAGY,IAAO,CAAA,OAAA,GAAG,KAAK,CAAA;KA+B1B;AA7BC,IAAA,IAAI,MAAM,GAAA;QACR,OAAO,IAAI,CAAC,OAAO,CAAA;KACpB;AAED,IAAA,IAAI,CAAC,KAAa,EAAA;QAChB,MAAM,MAAM,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAA;AACvC,QAAA,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;KAChC;IAEa,QAAQ,GAAA;;AACpB,YAAA,MAAMA,QAAM,GAAG,IAAIC,aAAM,EAAgB,CAAA;YAEzC,IAAI;AACF,gBAAA,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAED,QAAM,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAA;AAC7D,gBAAA,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAEA,QAAM,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAA;AAC7D,gBAAA,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAEA,QAAM,CAAC,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAA;gBAC3D,MAAMA,QAAM,CAAC,OAAO,CAAA;AACrB,aAAA;AAAS,oBAAA;gBACR,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAEA,QAAM,CAAC,GAAG,CAAC,CAAA;gBAC7C,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAEA,QAAM,CAAC,GAAG,CAAC,CAAA;gBAC7C,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAEA,QAAM,CAAC,EAAE,CAAC,CAAA;AAC5C,aAAA;SACF,CAAA,CAAA;AAAA,KAAA;IAEK,IAAI,GAAA;;AACR,YAAA,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAA;AAC5B,YAAA,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAA;AAC3B,YAAA,MAAM,IAAI,CAAA;SACX,CAAA,CAAA;AAAA,KAAA;AACF;;;;"}