{"version":3,"file":"signer.cjs","sources":["../../../../../../../../src/mods/tor/binary/certs/ed25519/extensions/signer.ts"],"sourcesContent":["import { Ed25519PublicKey, Ed25519Signature } from \"@hazae41/berith\";\nimport { Binary } from \"libs/binary.js\";\nimport { Cert } from \"mods/tor/binary/certs/ed25519/cert.js\";\nimport { Extension } from \"mods/tor/binary/certs/ed25519/extensions/extension.js\";\n\nexport class SignedWithEd25519Key implements Extension {\n  readonly class = SignedWithEd25519Key\n\n  static type = 4\n\n  constructor(\n    readonly length: number,\n    readonly flags: number,\n    readonly key: Buffer\n  ) { }\n\n  get type() {\n    return this.class.type\n  }\n\n  check(cert: Cert) {\n    const identity = new Ed25519PublicKey(this.key)\n    const signature = new Ed25519Signature(cert.signature)\n    const verified = identity.verify(cert.payload, signature)\n    if (!verified) throw new Error(`Invalid signer for Ed25519 Cert`)\n  }\n\n  write(binary: Binary) {\n    throw new Error(`Unimplemented`)\n  }\n\n  static read(binary: Binary, length: number, flags: number) {\n    const start = binary.offset\n\n    const key = binary.read(32)\n\n    if (binary.offset - start !== length)\n      throw new Error(`Invalid Ed25519 cert extension SignedWithEd25519Key length ${length}`)\n    return new this(length, flags, key)\n  }\n}"],"names":["Ed25519PublicKey","Ed25519Signature"],"mappings":";;;;MAKa,oBAAoB,CAAA;AAK/B,IAAA,WAAA,CACW,MAAc,EACd,KAAa,EACb,GAAW,EAAA;QAFX,IAAM,CAAA,MAAA,GAAN,MAAM,CAAQ;QACd,IAAK,CAAA,KAAA,GAAL,KAAK,CAAQ;QACb,IAAG,CAAA,GAAA,GAAH,GAAG,CAAQ;QAPb,IAAK,CAAA,KAAA,GAAG,oBAAoB,CAAA;KAQhC;AAEL,IAAA,IAAI,IAAI,GAAA;AACN,QAAA,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAA;KACvB;AAED,IAAA,KAAK,CAAC,IAAU,EAAA;QACd,MAAM,QAAQ,GAAG,IAAIA,uBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAC/C,MAAM,SAAS,GAAG,IAAIC,uBAAgB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;AACtD,QAAA,MAAM,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,SAAS,CAAC,CAAA;AACzD,QAAA,IAAI,CAAC,QAAQ;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,+BAAA,CAAiC,CAAC,CAAA;KAClE;AAED,IAAA,KAAK,CAAC,MAAc,EAAA;AAClB,QAAA,MAAM,IAAI,KAAK,CAAC,CAAA,aAAA,CAAe,CAAC,CAAA;KACjC;AAED,IAAA,OAAO,IAAI,CAAC,MAAc,EAAE,MAAc,EAAE,KAAa,EAAA;AACvD,QAAA,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAA;QAE3B,MAAM,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;AAE3B,QAAA,IAAI,MAAM,CAAC,MAAM,GAAG,KAAK,KAAK,MAAM;AAClC,YAAA,MAAM,IAAI,KAAK,CAAC,8DAA8D,MAAM,CAAA,CAAE,CAAC,CAAA;QACzF,OAAO,IAAI,IAAI,CAAC,MAAM,EAAE,KAAK,EAAE,GAAG,CAAC,CAAA;KACpC;;AA/BM,oBAAI,CAAA,IAAA,GAAG,CAAC;;;;"}