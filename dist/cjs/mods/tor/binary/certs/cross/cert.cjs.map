{"version":3,"file":"cert.cjs","sources":["../../../../../../../src/mods/tor/binary/certs/cross/cert.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\";\nimport { Cert as ICert } from \"mods/tor/binary/certs/cert.js\";\n\nexport class Cert implements ICert {\n  readonly class = Cert\n\n  static types = {\n    ID_TO_EID: 7\n  }\n\n  constructor(\n    readonly type: number,\n    readonly key: Buffer,\n    readonly expiration: Date,\n    readonly payload: Buffer,\n    readonly signature: Buffer\n  ) { }\n\n  write(binary: Binary) {\n    throw new Error(`Unimplemented`)\n  }\n\n  check() {\n    const now = new Date()\n\n    if (now > this.expiration)\n      throw new Error(`Late certificate`)\n  }\n\n  static read(binary: Binary, type: number, length: number) {\n    const start = binary.offset\n\n    const key = binary.read(32)\n\n    const expDateHours = binary.readUint32()\n    const expiration = new Date(expDateHours * 60 * 60 * 1000)\n\n    const payload = binary.reread(start)\n\n    const sigLength = binary.readUint8()\n    const signature = binary.read(sigLength)\n\n    if (binary.offset - start !== length)\n      throw new Error(`Invalid Cross cert length ${length}`)\n    return new this(type, key, expiration, payload, signature)\n  }\n}"],"names":[],"mappings":";;MAGa,IAAI,CAAA;IAOf,WACW,CAAA,IAAY,EACZ,GAAW,EACX,UAAgB,EAChB,OAAe,EACf,SAAiB,EAAA;QAJjB,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAQ;QACZ,IAAG,CAAA,GAAA,GAAH,GAAG,CAAQ;QACX,IAAU,CAAA,UAAA,GAAV,UAAU,CAAM;QAChB,IAAO,CAAA,OAAA,GAAP,OAAO,CAAQ;QACf,IAAS,CAAA,SAAA,GAAT,SAAS,CAAQ;QAXnB,IAAK,CAAA,KAAA,GAAG,IAAI,CAAA;KAYhB;AAEL,IAAA,KAAK,CAAC,MAAc,EAAA;AAClB,QAAA,MAAM,IAAI,KAAK,CAAC,CAAA,aAAA,CAAe,CAAC,CAAA;KACjC;IAED,KAAK,GAAA;AACH,QAAA,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAA;AAEtB,QAAA,IAAI,GAAG,GAAG,IAAI,CAAC,UAAU;AACvB,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,gBAAA,CAAkB,CAAC,CAAA;KACtC;AAED,IAAA,OAAO,IAAI,CAAC,MAAc,EAAE,IAAY,EAAE,MAAc,EAAA;AACtD,QAAA,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAA;QAE3B,MAAM,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;AAE3B,QAAA,MAAM,YAAY,GAAG,MAAM,CAAC,UAAU,EAAE,CAAA;AACxC,QAAA,MAAM,UAAU,GAAG,IAAI,IAAI,CAAC,YAAY,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAA;QAE1D,MAAM,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;AAEpC,QAAA,MAAM,SAAS,GAAG,MAAM,CAAC,SAAS,EAAE,CAAA;QACpC,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;AAExC,QAAA,IAAI,MAAM,CAAC,MAAM,GAAG,KAAK,KAAK,MAAM;AAClC,YAAA,MAAM,IAAI,KAAK,CAAC,6BAA6B,MAAM,CAAA,CAAE,CAAC,CAAA;AACxD,QAAA,OAAO,IAAI,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE,UAAU,EAAE,OAAO,EAAE,SAAS,CAAC,CAAA;KAC3D;;AAvCM,IAAA,CAAA,KAAK,GAAG;AACb,IAAA,SAAS,EAAE,CAAC;CACb;;;;"}