{"version":3,"file":"cert.cjs","sources":["../../../../../../../src/mods/tor/binary/certs/rsa/cert.ts"],"sourcesContent":["import { X509Certificate } from \"@peculiar/x509\";\nimport { Binary } from \"libs/binary.js\";\nimport { Cert as ICert } from \"mods/tor/binary/certs/cert.js\";\n\nexport class Cert implements ICert {\n  readonly class = Cert\n\n  static types = {\n    ID: 2,\n    ID_TO_TLS: 1,\n    ID_TO_AUTH: 3\n  }\n\n  constructor(\n    readonly type: number,\n    readonly data: Buffer,\n    readonly cert: X509Certificate\n  ) { }\n\n  write(binary: Binary) {\n    binary.writeUint8(this.type)\n    binary.writeUint16(this.data.length)\n    binary.write(this.data)\n  }\n\n  check() {\n    const now = new Date()\n\n    if (now > this.cert.notAfter)\n      throw new Error(`Late certificate`)\n    if (now < this.cert.notBefore)\n      throw new Error(`Early certificate`)\n  }\n\n  static read(binary: Binary, type: number, length: number) {\n    const start = binary.offset\n\n    const data = binary.read(length)\n    const cert = new X509Certificate(data)\n\n    if (binary.offset - start !== length)\n      throw new Error(`Invalid RSA cert length ${length}`)\n    return new this(type, data, cert)\n  }\n\n}"],"names":["X509Certificate"],"mappings":";;;;MAIa,IAAI,CAAA;AASf,IAAA,WAAA,CACW,IAAY,EACZ,IAAY,EACZ,IAAqB,EAAA;QAFrB,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAQ;QACZ,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAQ;QACZ,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAiB;QAXvB,IAAK,CAAA,KAAA,GAAG,IAAI,CAAA;KAYhB;AAEL,IAAA,KAAK,CAAC,MAAc,EAAA;AAClB,QAAA,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAC5B,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;AACpC,QAAA,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;KACxB;IAED,KAAK,GAAA;AACH,QAAA,MAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAA;AAEtB,QAAA,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ;AAC1B,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,gBAAA,CAAkB,CAAC,CAAA;AACrC,QAAA,IAAI,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS;AAC3B,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,iBAAA,CAAmB,CAAC,CAAA;KACvC;AAED,IAAA,OAAO,IAAI,CAAC,MAAc,EAAE,IAAY,EAAE,MAAc,EAAA;AACtD,QAAA,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAA;QAE3B,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;AAChC,QAAA,MAAM,IAAI,GAAG,IAAIA,oBAAe,CAAC,IAAI,CAAC,CAAA;AAEtC,QAAA,IAAI,MAAM,CAAC,MAAM,GAAG,KAAK,KAAK,MAAM;AAClC,YAAA,MAAM,IAAI,KAAK,CAAC,2BAA2B,MAAM,CAAA,CAAE,CAAC,CAAA;QACtD,OAAO,IAAI,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAA;KAClC;;AApCM,IAAA,CAAA,KAAK,GAAG;AACb,IAAA,EAAE,EAAE,CAAC;AACL,IAAA,SAAS,EAAE,CAAC;AACZ,IAAA,UAAU,EAAE,CAAC;CACd;;;;"}