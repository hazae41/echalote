{"version":3,"file":"versions.cjs","sources":["../../../../../../../src/mods/tor/binary/cells/direct/versions.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\"\nimport { OldCell } from \"mods/tor/binary/cells/cell.js\"\nimport { InvalidCircuit, InvalidCommand } from \"mods/tor/binary/cells/errors.js\"\n\nexport class VersionsCell {\n  readonly class = VersionsCell\n\n  static command = 7\n\n  constructor(\n    readonly circuit: undefined,\n    readonly versions: number[]\n  ) { }\n\n  pack() {\n    return this.cell().pack()\n  }\n\n  cell() {\n    const binary = Binary.allocUnsafe(this.versions.length * 2)\n\n    for (const version of this.versions)\n      binary.writeUint16(version)\n\n    return new OldCell(this.circuit, this.class.command, binary.buffer)\n  }\n\n  static uncell(cell: OldCell) {\n    if (cell.command !== this.command)\n      throw new InvalidCommand(this.name, cell.command)\n    if (cell.circuit)\n      throw new InvalidCircuit(this.name, cell.circuit)\n\n    const binary = new Binary(cell.payload)\n\n    const nversions = cell.payload.length / 2\n    const versions = new Array<number>(nversions)\n\n    for (let i = 0; i < nversions; i++)\n      versions[i] = binary.readUint16()\n\n    return new this(cell.circuit, versions)\n  }\n\n}"],"names":["binary","Binary","OldCell","InvalidCommand","InvalidCircuit"],"mappings":";;;;;;MAIa,YAAY,CAAA;IAKvB,WACW,CAAA,OAAkB,EAClB,QAAkB,EAAA;QADlB,IAAO,CAAA,OAAA,GAAP,OAAO,CAAW;QAClB,IAAQ,CAAA,QAAA,GAAR,QAAQ,CAAU;QANpB,IAAK,CAAA,KAAA,GAAG,YAAY,CAAA;KAOxB;IAEL,IAAI,GAAA;AACF,QAAA,OAAO,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAA;KAC1B;IAED,IAAI,GAAA;AACF,QAAA,MAAMA,QAAM,GAAGC,aAAM,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;AAE3D,QAAA,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,QAAQ;AACjC,YAAAD,QAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAA;AAE7B,QAAA,OAAO,IAAIE,YAAO,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EAAEF,QAAM,CAAC,MAAM,CAAC,CAAA;KACpE;IAED,OAAO,MAAM,CAAC,IAAa,EAAA;AACzB,QAAA,IAAI,IAAI,CAAC,OAAO,KAAK,IAAI,CAAC,OAAO;YAC/B,MAAM,IAAIG,qBAAc,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAA;QACnD,IAAI,IAAI,CAAC,OAAO;YACd,MAAM,IAAIC,qBAAc,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAA;QAEnD,MAAMJ,QAAM,GAAG,IAAIC,aAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QAEvC,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAA;AACzC,QAAA,MAAM,QAAQ,GAAG,IAAI,KAAK,CAAS,SAAS,CAAC,CAAA;QAE7C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,EAAE,CAAC,EAAE;YAChC,QAAQ,CAAC,CAAC,CAAC,GAAGD,QAAM,CAAC,UAAU,EAAE,CAAA;QAEnC,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAA;KACxC;;AAnCM,YAAO,CAAA,OAAA,GAAG,CAAC;;;;"}