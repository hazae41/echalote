{"version":3,"file":"destroy.cjs","sources":["../../../../../../../src/mods/tor/binary/cells/direct/destroy.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\"\nimport { NewCell } from \"mods/tor/binary/cells/cell.js\"\nimport { Circuit } from \"mods/tor/circuit.js\"\nimport { PAYLOAD_LEN } from \"mods/tor/constants.js\"\n\nexport class DestroyCell {\n  readonly class = DestroyCell\n\n  static command = 4\n\n  static reasons = {\n    NONE: 0,\n    PROTOCOL: 1,\n    INTERNAL: 2,\n    REQUESTED: 3,\n    HIBERNATING: 4,\n    RESOURCELIMIT: 5,\n    CONNECTFAILED: 6,\n    OR_IDENTITY: 7,\n    CHANNEL_CLOSED: 8,\n    FINISHED: 9,\n    TIMEOUT: 10,\n    DESTROYED: 11,\n    NOSUCHSERVICE: 12\n  }\n\n  constructor(\n    readonly circuit: Circuit,\n    readonly reason: number\n  ) { }\n\n  pack() {\n    return this.cell().pack()\n  }\n\n  cell() {\n    const binary = Binary.allocUnsafe(PAYLOAD_LEN)\n\n    binary.writeUint8(this.reason)\n    binary.fill()\n\n    return new NewCell(this.circuit, this.class.command, binary.buffer)\n  }\n\n  static uncell(cell: NewCell) {\n    if (cell.command !== this.command)\n      throw new Error(`Invalid DESTROY cell command ${cell.command}`)\n    if (!cell.circuit)\n      throw new Error(`Can't uncell DESTROY cell on circuit 0`)\n\n    const binary = new Binary(cell.payload)\n\n    const code = binary.readUint8()\n\n    return new this(cell.circuit, code)\n  }\n}"],"names":["binary","Binary","PAYLOAD_LEN","NewCell"],"mappings":";;;;;;MAKa,WAAW,CAAA;IAqBtB,WACW,CAAA,OAAgB,EAChB,MAAc,EAAA;QADd,IAAO,CAAA,OAAA,GAAP,OAAO,CAAS;QAChB,IAAM,CAAA,MAAA,GAAN,MAAM,CAAQ;QAtBhB,IAAK,CAAA,KAAA,GAAG,WAAW,CAAA;KAuBvB;IAEL,IAAI,GAAA;AACF,QAAA,OAAO,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAA;KAC1B;IAED,IAAI,GAAA;QACF,MAAMA,QAAM,GAAGC,aAAM,CAAC,WAAW,CAACC,qBAAW,CAAC,CAAA;AAE9C,QAAAF,QAAM,CAAC,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;QAC9BA,QAAM,CAAC,IAAI,EAAE,CAAA;AAEb,QAAA,OAAO,IAAIG,YAAO,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EAAEH,QAAM,CAAC,MAAM,CAAC,CAAA;KACpE;IAED,OAAO,MAAM,CAAC,IAAa,EAAA;AACzB,QAAA,IAAI,IAAI,CAAC,OAAO,KAAK,IAAI,CAAC,OAAO;YAC/B,MAAM,IAAI,KAAK,CAAC,CAAA,6BAAA,EAAgC,IAAI,CAAC,OAAO,CAAE,CAAA,CAAC,CAAA;QACjE,IAAI,CAAC,IAAI,CAAC,OAAO;AACf,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,sCAAA,CAAwC,CAAC,CAAA;QAE3D,MAAMA,QAAM,GAAG,IAAIC,aAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;AAEvC,QAAA,MAAM,IAAI,GAAGD,QAAM,CAAC,SAAS,EAAE,CAAA;QAE/B,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,CAAA;KACpC;;AA/CM,WAAO,CAAA,OAAA,GAAG,CAAC,CAAA;AAEX,WAAA,CAAA,OAAO,GAAG;AACf,IAAA,IAAI,EAAE,CAAC;AACP,IAAA,QAAQ,EAAE,CAAC;AACX,IAAA,QAAQ,EAAE,CAAC;AACX,IAAA,SAAS,EAAE,CAAC;AACZ,IAAA,WAAW,EAAE,CAAC;AACd,IAAA,aAAa,EAAE,CAAC;AAChB,IAAA,aAAa,EAAE,CAAC;AAChB,IAAA,WAAW,EAAE,CAAC;AACd,IAAA,cAAc,EAAE,CAAC;AACjB,IAAA,QAAQ,EAAE,CAAC;AACX,IAAA,OAAO,EAAE,EAAE;AACX,IAAA,SAAS,EAAE,EAAE;AACb,IAAA,aAAa,EAAE,EAAE;CAClB;;;;"}