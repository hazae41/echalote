{"version":3,"file":"cell.cjs","sources":["../../../../../../../../src/mods/tor/binary/cells/direct/created_fast/cell.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\";\nimport { NewCell } from \"mods/tor/binary/cells/cell.js\";\nimport { InvalidCircuit, InvalidCommand } from \"mods/tor/binary/cells/errors.js\";\nimport { Circuit } from \"mods/tor/circuit.js\";\nimport { PAYLOAD_LEN } from \"mods/tor/constants.js\";\n\nexport class CreatedFastCell {\n  readonly class = CreatedFastCell\n\n  static command = 6\n\n  constructor(\n    readonly circuit: Circuit,\n    readonly material: Buffer,\n    readonly derivative: Buffer\n  ) { }\n\n  pack() {\n    return this.cell().pack()\n  }\n\n  cell() {\n    const binary = Binary.allocUnsafe(PAYLOAD_LEN)\n\n    binary.write(this.material)\n    binary.write(this.derivative)\n    binary.fill()\n\n    return new NewCell(this.circuit, this.class.command, binary.buffer)\n  }\n\n  static uncell(cell: NewCell) {\n    if (cell.command !== this.command)\n      throw new InvalidCommand(this.name, cell.command)\n    if (!cell.circuit)\n      throw new InvalidCircuit(this.name, cell.circuit)\n\n    const binary = new Binary(cell.payload)\n\n    const material = binary.read(20)\n    const derivative = binary.read(20)\n\n    return new this(cell.circuit, material, derivative)\n  }\n}"],"names":["binary","Binary","PAYLOAD_LEN","NewCell","InvalidCommand","InvalidCircuit"],"mappings":";;;;;;;MAMa,eAAe,CAAA;AAK1B,IAAA,WAAA,CACW,OAAgB,EAChB,QAAgB,EAChB,UAAkB,EAAA;QAFlB,IAAO,CAAA,OAAA,GAAP,OAAO,CAAS;QAChB,IAAQ,CAAA,QAAA,GAAR,QAAQ,CAAQ;QAChB,IAAU,CAAA,UAAA,GAAV,UAAU,CAAQ;QAPpB,IAAK,CAAA,KAAA,GAAG,eAAe,CAAA;KAQ3B;IAEL,IAAI,GAAA;AACF,QAAA,OAAO,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAA;KAC1B;IAED,IAAI,GAAA;QACF,MAAMA,QAAM,GAAGC,aAAM,CAAC,WAAW,CAACC,qBAAW,CAAC,CAAA;AAE9C,QAAAF,QAAM,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;AAC3B,QAAAA,QAAM,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QAC7BA,QAAM,CAAC,IAAI,EAAE,CAAA;AAEb,QAAA,OAAO,IAAIG,YAAO,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EAAEH,QAAM,CAAC,MAAM,CAAC,CAAA;KACpE;IAED,OAAO,MAAM,CAAC,IAAa,EAAA;AACzB,QAAA,IAAI,IAAI,CAAC,OAAO,KAAK,IAAI,CAAC,OAAO;YAC/B,MAAM,IAAII,qBAAc,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAA;QACnD,IAAI,CAAC,IAAI,CAAC,OAAO;YACf,MAAM,IAAIC,qBAAc,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAA;QAEnD,MAAML,QAAM,GAAG,IAAIC,aAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QAEvC,MAAM,QAAQ,GAAGD,QAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;QAChC,MAAM,UAAU,GAAGA,QAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;QAElC,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAA;KACpD;;AAlCM,eAAO,CAAA,OAAA,GAAG,CAAC;;;;"}