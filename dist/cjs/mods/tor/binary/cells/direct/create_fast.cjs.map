{"version":3,"file":"create_fast.cjs","sources":["../../../../../../../src/mods/tor/binary/cells/direct/create_fast.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\";\nimport { NewCell } from \"mods/tor/binary/cells/cell.js\";\nimport { Circuit } from \"mods/tor/circuit.js\";\nimport { PAYLOAD_LEN } from \"mods/tor/constants.js\";\n\nexport class CreateFastCell {\n  readonly class = CreateFastCell\n\n  static command = 5\n\n  /**\n   * The CREATE_FAST cell\n   * @param material Key material (X) [20]\n   */\n  constructor(\n    readonly circuit: Circuit,\n    readonly material: Buffer\n  ) { }\n\n  pack() {\n    return this.cell().pack()\n  }\n\n  cell() {\n    const binary = Binary.allocUnsafe(PAYLOAD_LEN)\n\n    if (this.material.length !== 20)\n      throw new Error(`Invalid CREATE_FAST cell material length`)\n    binary.write(this.material)\n    binary.fill()\n\n    return new NewCell(this.circuit, this.class.command, binary.buffer)\n  }\n\n  static uncell(cell: NewCell) {\n    if (cell.command !== this.command)\n      throw new Error(`Invalid CREATE_FAST cell command ${cell.command}`)\n    if (!cell.circuit)\n      throw new Error(`Can't uncell CREATE_FAST cell on circuit 0`)\n\n    const binary = new Binary(cell.payload)\n\n    const material = binary.read(20)\n\n    return new this(cell.circuit, material)\n  }\n}"],"names":["binary","Binary","PAYLOAD_LEN","NewCell"],"mappings":";;;;;;MAKa,cAAc,CAAA;AAKzB;;;AAGG;IACH,WACW,CAAA,OAAgB,EAChB,QAAgB,EAAA;QADhB,IAAO,CAAA,OAAA,GAAP,OAAO,CAAS;QAChB,IAAQ,CAAA,QAAA,GAAR,QAAQ,CAAQ;QAVlB,IAAK,CAAA,KAAA,GAAG,cAAc,CAAA;KAW1B;IAEL,IAAI,GAAA;AACF,QAAA,OAAO,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAA;KAC1B;IAED,IAAI,GAAA;QACF,MAAMA,QAAM,GAAGC,aAAM,CAAC,WAAW,CAACC,qBAAW,CAAC,CAAA;AAE9C,QAAA,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,EAAE;AAC7B,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,wCAAA,CAA0C,CAAC,CAAA;AAC7D,QAAAF,QAAM,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QAC3BA,QAAM,CAAC,IAAI,EAAE,CAAA;AAEb,QAAA,OAAO,IAAIG,YAAO,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EAAEH,QAAM,CAAC,MAAM,CAAC,CAAA;KACpE;IAED,OAAO,MAAM,CAAC,IAAa,EAAA;AACzB,QAAA,IAAI,IAAI,CAAC,OAAO,KAAK,IAAI,CAAC,OAAO;YAC/B,MAAM,IAAI,KAAK,CAAC,CAAA,iCAAA,EAAoC,IAAI,CAAC,OAAO,CAAE,CAAA,CAAC,CAAA;QACrE,IAAI,CAAC,IAAI,CAAC,OAAO;AACf,YAAA,MAAM,IAAI,KAAK,CAAC,CAAA,0CAAA,CAA4C,CAAC,CAAA;QAE/D,MAAMA,QAAM,GAAG,IAAIC,aAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QAEvC,MAAM,QAAQ,GAAGD,QAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAA;QAEhC,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAA;KACxC;;AArCM,cAAO,CAAA,OAAA,GAAG,CAAC;;;;"}