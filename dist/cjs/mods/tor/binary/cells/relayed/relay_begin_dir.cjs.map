{"version":3,"file":"relay_begin_dir.cjs","sources":["../../../../../../../src/mods/tor/binary/cells/relayed/relay_begin_dir.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\";\nimport { RelayCell } from \"mods/tor/binary/cells/direct/relay.js\";\nimport { InvalidRelayCommand, InvalidStream } from \"mods/tor/binary/cells/errors.js\";\nimport { Circuit } from \"mods/tor/circuit.js\";\nimport { PAYLOAD_LEN } from \"mods/tor/constants.js\";\nimport { TcpStream } from \"mods/tor/streams/tcp.js\";\n\nexport class RelayBeginDirCell {\n  readonly class = RelayBeginDirCell\n\n  static rcommand = 13\n\n  constructor(\n    readonly circuit: Circuit,\n    readonly stream: TcpStream\n  ) { }\n\n  async pack() {\n    return await this.cell().pack()\n  }\n\n  cell() {\n    const binary = Binary.allocUnsafe(PAYLOAD_LEN)\n\n    binary.fill()\n\n    return new RelayCell(this.circuit, this.stream, this.class.rcommand, binary.sliced)\n  }\n\n  static uncell(cell: RelayCell) {\n    if (cell.rcommand !== this.rcommand)\n      throw new InvalidRelayCommand(this.name, cell.rcommand)\n    if (!cell.stream)\n      throw new InvalidStream(this.name, cell.stream)\n\n    if (cell.data.find(it => it !== 0))\n      throw new Error(`Invalid ${this.name} data`)\n\n    return new this(cell.circuit, cell.stream)\n  }\n}"],"names":["binary","Binary","PAYLOAD_LEN","RelayCell","InvalidRelayCommand","InvalidStream"],"mappings":";;;;;;;;MAOa,iBAAiB,CAAA;IAK5B,WACW,CAAA,OAAgB,EAChB,MAAiB,EAAA;QADjB,IAAO,CAAA,OAAA,GAAP,OAAO,CAAS;QAChB,IAAM,CAAA,MAAA,GAAN,MAAM,CAAW;QANnB,IAAK,CAAA,KAAA,GAAG,iBAAiB,CAAA;KAO7B;IAEC,IAAI,GAAA;;YACR,OAAO,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAA;SAChC,CAAA,CAAA;AAAA,KAAA;IAED,IAAI,GAAA;QACF,MAAMA,QAAM,GAAGC,aAAM,CAAC,WAAW,CAACC,qBAAW,CAAC,CAAA;QAE9CF,QAAM,CAAC,IAAI,EAAE,CAAA;QAEb,OAAO,IAAIG,eAAS,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAEH,QAAM,CAAC,MAAM,CAAC,CAAA;KACpF;IAED,OAAO,MAAM,CAAC,IAAe,EAAA;AAC3B,QAAA,IAAI,IAAI,CAAC,QAAQ,KAAK,IAAI,CAAC,QAAQ;YACjC,MAAM,IAAII,0BAAmB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAA;QACzD,IAAI,CAAC,IAAI,CAAC,MAAM;YACd,MAAM,IAAIC,oBAAa,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;AAEjD,QAAA,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;YAChC,MAAM,IAAI,KAAK,CAAC,CAAA,QAAA,EAAW,IAAI,CAAC,IAAI,CAAO,KAAA,CAAA,CAAC,CAAA;QAE9C,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;KAC3C;;AA7BM,iBAAQ,CAAA,QAAA,GAAG,EAAE;;;;"}