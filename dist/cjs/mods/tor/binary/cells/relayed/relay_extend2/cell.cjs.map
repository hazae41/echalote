{"version":3,"file":"cell.cjs","sources":["../../../../../../../../src/mods/tor/binary/cells/relayed/relay_extend2/cell.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\"\nimport { RelayEarlyCell } from \"mods/tor/binary/cells/direct/relay_early/cell.js\"\nimport { RelayExtend2Link } from \"mods/tor/binary/cells/relayed/relay_extend2/link.js\"\nimport { Circuit } from \"mods/tor/circuit.js\"\nimport { PAYLOAD_LEN } from \"mods/tor/constants.js\"\n\nexport class RelayExtend2Cell {\n  readonly class = RelayExtend2Cell\n\n  static rcommand = 14\n\n  static types = {\n    /**\n     * The old, slow, and insecure handshake\n     * @deprecated\n     */\n    TAP: 0,\n    /**\n     * The new, quick, and secure handshake\n     */\n    NTOR: 2\n  }\n\n  constructor(\n    readonly circuit: Circuit,\n    readonly stream: undefined,\n    readonly type: number,\n    readonly links: RelayExtend2Link[],\n    readonly data: Buffer\n  ) { }\n\n  async pack() {\n    return await this.cell().pack()\n  }\n\n  cell() {\n    const binary = Binary.allocUnsafe(PAYLOAD_LEN)\n\n    binary.writeUint8(this.links.length)\n\n    for (const link of this.links)\n      link.write(binary)\n\n    binary.writeUint16(this.type)\n    binary.writeUint16(this.data.length)\n    binary.write(this.data)\n\n    return new RelayEarlyCell(this.circuit, this.stream, this.class.rcommand, binary.sliced)\n  }\n}"],"names":["binary","Binary","PAYLOAD_LEN","RelayEarlyCell"],"mappings":";;;;;;;MAMa,gBAAgB,CAAA;IAiB3B,WACW,CAAA,OAAgB,EAChB,MAAiB,EACjB,IAAY,EACZ,KAAyB,EACzB,IAAY,EAAA;QAJZ,IAAO,CAAA,OAAA,GAAP,OAAO,CAAS;QAChB,IAAM,CAAA,MAAA,GAAN,MAAM,CAAW;QACjB,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAQ;QACZ,IAAK,CAAA,KAAA,GAAL,KAAK,CAAoB;QACzB,IAAI,CAAA,IAAA,GAAJ,IAAI,CAAQ;QArBd,IAAK,CAAA,KAAA,GAAG,gBAAgB,CAAA;KAsB5B;IAEC,IAAI,GAAA;;YACR,OAAO,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAA;SAChC,CAAA,CAAA;AAAA,KAAA;IAED,IAAI,GAAA;QACF,MAAMA,QAAM,GAAGC,aAAM,CAAC,WAAW,CAACC,qBAAW,CAAC,CAAA;QAE9CF,QAAM,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAA;AAEpC,QAAA,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK;AAC3B,YAAA,IAAI,CAAC,KAAK,CAACA,QAAM,CAAC,CAAA;AAEpB,QAAAA,QAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAC7BA,QAAM,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;AACpC,QAAAA,QAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAEvB,OAAO,IAAIG,mBAAc,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAEH,QAAM,CAAC,MAAM,CAAC,CAAA;KACzF;;AAvCM,gBAAQ,CAAA,QAAA,GAAG,EAAE,CAAA;AAEb,gBAAA,CAAA,KAAK,GAAG;AACb;;;AAGG;AACH,IAAA,GAAG,EAAE,CAAC;AACN;;AAEG;AACH,IAAA,IAAI,EAAE,CAAC;CACR;;;;"}