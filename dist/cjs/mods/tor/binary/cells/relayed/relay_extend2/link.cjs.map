{"version":3,"file":"link.cjs","sources":["../../../../../../../../src/mods/tor/binary/cells/relayed/relay_extend2/link.ts"],"sourcesContent":["import { Binary } from \"libs/binary.js\"\n\nexport type RelayExtend2Link =\n  | RelayExtend2LinkIPv4\n  | RelayExtend2LinkIPv6\n  | RelayExtend2LinkLegacyID\n  | RelayExtend2LinkModernID\n\nexport class RelayExtend2LinkIPv4 {\n  readonly class = RelayExtend2LinkIPv4\n\n  static type = 0\n\n  constructor(\n    readonly hostname: string,\n    readonly port: number,\n  ) { }\n\n  write(binary: Binary) {\n    binary.writeUint8(this.class.type)\n    binary.writeUint8(4 + 2)\n\n    const [a, b, c, d] = this.hostname.split(\".\")\n    binary.writeUint8(Number(a))\n    binary.writeUint8(Number(b))\n    binary.writeUint8(Number(c))\n    binary.writeUint8(Number(d))\n\n    binary.writeUint16(this.port)\n  }\n\n  static from(host: string) {\n    const { hostname, port } = new URL(`http://${host}`)\n    return new this(hostname, Number(port))\n  }\n}\n\nexport class RelayExtend2LinkIPv6 {\n  readonly class = RelayExtend2LinkIPv6\n\n  static type = 1\n\n  constructor(\n    readonly hostname: string,\n    readonly port: number,\n  ) { }\n\n  write(binary: Binary) {\n    binary.writeUint8(this.class.type)\n    binary.writeUint8(16 + 2)\n\n    const [a, b, c, d, e, f, g, h] = this.hostname.split(\":\")\n    binary.writeUint16(Number(`0x${a}`) || 0)\n    binary.writeUint16(Number(`0x${b}`) || 0)\n    binary.writeUint16(Number(`0x${c}`) || 0)\n    binary.writeUint16(Number(`0x${d}`) || 0)\n    binary.writeUint16(Number(`0x${e}`) || 0)\n    binary.writeUint16(Number(`0x${f}`) || 0)\n    binary.writeUint16(Number(`0x${g}`) || 0)\n    binary.writeUint16(Number(`0x${h}`) || 0)\n\n    binary.writeUint16(this.port)\n  }\n\n  static from(host: string) {\n    const { hostname, port } = new URL(`http://${host}`)\n    return new this(hostname.slice(1, -1), Number(port))\n  }\n}\n\nexport class RelayExtend2LinkLegacyID {\n  readonly class = RelayExtend2LinkLegacyID\n\n  static type = 2\n\n  constructor(\n    readonly fingerprint: Buffer\n  ) { }\n\n  write(binary: Binary) {\n    binary.writeUint8(this.class.type)\n    binary.writeUint8(20)\n    binary.write(this.fingerprint)\n  }\n}\n\nexport class RelayExtend2LinkModernID {\n  readonly class = RelayExtend2LinkModernID\n\n  static type = 3\n\n  constructor(\n    readonly fingerprint: Buffer\n  ) { }\n\n  write(binary: Binary) {\n    binary.writeUint8(this.class.type)\n    binary.writeUint8(32)\n    binary.write(this.fingerprint)\n  }\n}"],"names":[],"mappings":"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"}