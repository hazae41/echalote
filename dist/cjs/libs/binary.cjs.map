{"version":3,"file":"binary.cjs","sources":["../../../src/libs/binary.ts"],"sourcesContent":["export class Binary {\n  readonly class = Binary\n\n  offset = 0\n\n  constructor(\n    public buffer: Buffer\n  ) { }\n\n  static alloc(length: number) {\n    return new Binary(Buffer.alloc(length))\n  }\n\n  static allocUnsafe(length: number) {\n    return new Binary(Buffer.allocUnsafe(length))\n  }\n\n  get remaining() {\n    return this.buffer.length - this.offset\n  }\n\n  get sliced() {\n    return this.buffer.subarray(0, this.offset)\n  }\n\n  read(length: number, shallow = false) {\n    if (this.offset + length > this.buffer.length)\n      throw new Error(`Out of bound read`)\n    const b = this.buffer.subarray(this.offset, this.offset + length)\n    if (!shallow) this.offset += length\n    return b\n  }\n\n  write(array: Buffer, shallow = false) {\n    if (this.offset + length > this.buffer.length)\n      throw new Error(`Out of bound write`)\n    this.buffer.set(array, this.offset)\n    if (!shallow) this.offset += array.length\n  }\n\n  fill(end?: number) {\n    this.buffer.fill(0, this.offset, end)\n  }\n\n  readUint8(shallow = false) {\n    const x = this.buffer.readUInt8(this.offset)\n    if (!shallow) this.offset++\n    return x\n  }\n\n  writeUint8(x: number, shallow = false) {\n    this.buffer.writeUInt8(x, this.offset)\n    if (!shallow) this.offset++\n  }\n\n  readUint16(shallow = false) {\n    const x = this.buffer.readUInt16BE(this.offset)\n    if (!shallow) this.offset += 2\n    return x\n  }\n\n  writeUint16(x: number, shallow = false) {\n    this.buffer.writeUInt16BE(x, this.offset)\n    if (!shallow) this.offset += 2\n  }\n\n  readUint32(shallow = false) {\n    const x = this.buffer.readUInt32BE(this.offset)\n    if (!shallow) this.offset += 4\n    return x\n  }\n\n  writeUint32(x: number, shallow = false) {\n    this.buffer.writeUInt32BE(x, this.offset)\n    if (!shallow) this.offset += 4\n  }\n\n  readString(length: number) {\n    return this.read(length).toString()\n  }\n\n  writeString(text: string) {\n    this.write(Buffer.from(text))\n  }\n\n  readNull() {\n    let i = this.offset\n\n    while (i < this.buffer.length && this.buffer[i] > 0)\n      i++\n    if (i === this.buffer.length)\n      throw new Error(`Out of bounds NULL-terminated`)\n    return this.read(i)\n  }\n\n  writeNull(array: Buffer) {\n    this.write(array)\n    this.writeUint8(0)\n  }\n\n  readNullString() {\n    return this.readNull().toString()\n  }\n\n  writeNullString(text: string) {\n    this.writeNull(Buffer.from(text))\n  }\n\n  reread(offset: number) {\n    const head = this.offset\n    this.offset = offset\n    return this.read(head - offset)\n  }\n\n  split(length: number) {\n    const chunks = new Array<Buffer>()\n\n    while (this.remaining)\n      chunks.push(this.read(Math.min(this.remaining, length)))\n    return chunks\n  }\n}"],"names":[],"mappings":"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"}